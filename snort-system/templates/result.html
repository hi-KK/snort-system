<html>
 <head></head>
 <body>
  {% load staticfiles %}    
  <meta charset="UTF-8" /> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0" /> 
  <title></title> 
  <link rel="stylesheet" href="{% static 'css/amazeui.min.css' %}" /> 
  <link rel="stylesheet" href="{% static 'css/admin.css' %}" /> 
  <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.2.0/css/bootstrap.min.css" /> 
  <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.2.0/css/bootstrap-theme.min.css" /> 
  <script src="http://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script> 
  <script src="http://cdn.bootcss.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>   
  <div class="admin-content-body"> 
   <div class="am-cf am-padding am-padding-bottom-0"> 
    <div class="am-fl am-cf">
     <strong class="am-text-primary am-text-lg"></strong>
     <small></small>
    </div> 
   </div> 
   <hr /> 
   <!-- 新增start --> 
   <p> </p> 
   <hr /> 
   <div class="am-g"> 
   </div> 
   <p></p> 
   <p></p> 
   <div class="am-u-sm-12 am-u-md-6"> 
    <div class="am-btn-toolbar"> 
     <div class="am-btn-group am-btn-group-xs"> 
      <button type="button" class="am-btn am-btn-default" id="shield_id" onclick="_shield()"><span class="am-icon-close"></span> 屏蔽</button> 
     </div> 
    </div> 
   </div> 
   <!-- 新增end --> 
   <div class="am-g"> 
    <div class="am-u-sm-12"> 
     <form class="am-form"> 
      <table class="am-table am-table-striped am-table-hover table-main"> 
       <thead> 
        <tr> 
         <th nowrap="nowrap" class="table-check"><input type="checkbox" name="checkbox" /></th> 
         <th nowrap="nowrap" class="table-id" style="color: green">ID</th> 
         <th nowrap="nowrap" class="table-title" style="color: green">描述信息</th> 
         <th nowrap="nowrap" class="table-author am-hide-sm-only" style="color: green">类型</th> 
         <th nowrap="nowrap" class="table-type" style="color: green">恶意家族</th> 
         <th nowrap="nowrap" class="table-type" style="color: green">修订版本</th> 
         <th nowrap="nowrap" class="table-date am-hide-sm-only" style="color: green">创建时间</th> 
         <th nowrap="nowrap" class="table-set" style="color: green">修改时间</th> 
         <th nowrap="nowrap" class="table-check" style="color: green">检测</th> 
         <th nowrap="nowrap" class="table-download" style="color: green">下载</th> 
         <th nowrap="nowrap" class="table-delete" style="color: green">删除</th> 
         <th nowrap="nowrap" class="table-detail" style="color: green">详情</th> 
         <th nowrap="nowrap" class="table-detail" style="color: green">完整规则</th>
        </tr> 
       </thead> 
       <tbody>
         {% for rule in rules_sections %} 
        <tr> 
         <td><input type="checkbox" name="checkbox" value="{{rule.id}}" /></td> 
         <td width="80">{{rule.sid}}</td> 
         <td width="520px">{{rule.msg}}</td> 
         <td width="150px">{{rule.class_type}}</td> 
         <td width="220px">{{rule.malname}}</td> 
         <td width="100px">{{rule.rev}}</td> 
         <td width="160">{{rule.create_time}}</td> 
         <td>{{rule.update_time}}</td> 
         <td nowrap="nowrap" width="50px"> <a href="javascript:void(0)" onclick="check_rule('规则检测',5,'{{rule.sid}}')">检测</a> </td> 
         <td> <a href="javascript:void(0)" onclick="download_pcap('pcap下载',5, '{{rule.sid}}')">下载</a> </td> 
         <td> <a href="javascript:void(0)" onclick="delete_pcap('pcap删除',5, '{{rule.sid}}')">删除</a> </td> 
         <td> <a href="javascript:void(0)" onclick="view('规则详情',5,'{{rule.sid}}')">查看</a> </td> 
         <td> <a href="javascript:void(0)" onclick="view_complete('完整规则 '+'ID: '+'{{rule.sid}}',5,'{{rule.sid}}')">预览</a> </td> 
        </tr> {% endfor %} 
       </tbody> 
      </table> 
      <hr /> 
      <!-- 分页开始 --> 
      <div> 
       <ul class="pagination"> 
        <li><a href="/backstage/rules/result?page=1">首页</a></li> {% if rules_sections.has_previous %} 
        <li><a href="/backstage/rules/result?page={{ rules_sections.previous_page_number }}">上一页</a></li> {% endif %} 
        <li class=" "><span>第{{ rules_sections.number }}页 | 共{{ paginator.num_pages}}页</span></li> {% if rules_sections.has_next %} 
        <li><a href="/backstage/rules/result?page={{ rules_sections.next_page_number }}">下一页</a></li> {% endif %} 
        <li><a href="/backstage/rules/result?page={{ rules_sections.paginator.num_pages }}">尾页</a></li> 
       </ul> 
      </div> 
      <!-- 分页结束 --> 
     </form> 
    </div> 
   </div> 
  </div> 
  <script type="text/javascript" src="{% static 'js/jquery-1.11.3.min.js' %}"></script> 
  <script type="text/javascript" src="{% static 'myplugs/js/plugs.js' %}"></script> 
  <script type="text/javascript">
    function sleep(d){
                for(var t = Date.now();Date.now() - t <= d;);
              }
  </script>
  <script type="text/javascript">
            function view(title,id,sid){
                detail(sid)
                sleep(500);
                $.jq_Panel({
                title: title,
                iframeWidth: 550,
                iframeHeight: 620,
                url: "detail"
            })
            }
        </script> 
  <script type="text/javascript">
            function detail(sid){
                $.post("/backstage/rules/detail",{'sid':sid,'csrfmiddlewaretoken':'{{csrf_token}}' } , function(){
            });
            }
        </script> 
        <script type="text/javascript">
            function view_complete(title,id,sid){
                get_complete_rule(sid)
                sleep(500);
                $.jq_Panel({
                title: title,
                iframeWidth: 500,
                iframeHeight: 200,
                url: "complete"
            })
            }
        </script> 
  <script type="text/javascript">
            function get_complete_rule(sid){
                $.post("/backstage/rules/complete",{'sid':sid,'csrfmiddlewaretoken':'{{csrf_token}}' } , function(){
            });
            }
        </script>
  <script type="text/javascript">
            function search(){
                var txt = $(".am-form-field").val();
                $.post("/backstage/rules/search",{'search_data':txt,'csrfmiddlewaretoken':'{{csrf_token}}' } , function(){
            });
            }
        </script> 
  <script type="text/javascript">
            function check_rule(title,id,sid){

                $.jq_Panel({
                      title: title,
                      iframeWidth: 400,
                      iframeHeight: 100,
                      url: "/backstage/upload"
                });

                $.post("/backstage/upload/file",
                    {
                        'sid': sid,
                        'csrfmiddlewaretoken': '{{csrf_token}}',

                    }
                )

            }
        </script> 
  <script type="text/javascript">
            function download_pcap(title,id,sid){

                $.jq_Panel({
                      title: title,
                      iframeWidth: 400,
                      iframeHeight: 100,
                      url: "/backstage/download_pcap"
                });

                $.post("/backstage/download/pcap",
                    {
                        'sid': sid,
                        'csrfmiddlewaretoken': '{{csrf_token}}',
                        function(data){
                            if(data==0){
                                alert('该规则无命中的pcap!')
                            }
                        }
                    }
                )
            }
        </script> 
  <script type="text/javascript">
            function delete_pcap(title,id,sid){

                $.jq_Panel({
                      title: title,
                      iframeWidth: 400,
                      iframeHeight: 100,
                      url: "/backstage/delete_pcap"
                });

                $.post("/backstage/delete/pcap",
                    {
                        'sid': sid,
                        'flag': 'sent',
                        'csrfmiddlewaretoken': '{{csrf_token}}',
                    }
                )

            }
        </script> 
  <script type="text/javascript">
            function shield_rule(id){
                // alert(id)
                $.post("/backstage/rules/shield",{'id': id, 'csrfmiddlewaretoken':'{{csrf_token}}' } , function(data){
                    if(data==1){
                        alert('屏蔽成功!')
                    }else{
                        alert('屏蔽失败!')
                    }
            });
            }
        </script> 
  <script type="text/javascript">
            $("#shield_id").click(function(){
                $.each($('input:checkbox'),function(){
                    if(this.checked){
                        id = $(this).val()
                        // alert(id)
                        shield_rule(id)
                    }
                });
            });
        </script> 
  <script type="text/javascript">
                        //鼠标点击出现爱心特效
        (function(window,document,undefined){
            var hearts = [];
            window.requestAnimationFrame = (function(){
                return window.requestAnimationFrame ||
                window.webkitRequestAnimationFrame ||
                window.mozRequestAnimationFrame ||
                window.oRequestAnimationFrame ||
                window.msRequestAnimationFrame ||
                function (callback){
                    setTimeout(callback,1000/60);
                }
            })();
            init();
            function init(){
                css(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: absolute;}.heart:after{top: -5px;}.heart:before{left: -5px;}");
                attachEvent();
                gameloop();
            }
            function gameloop(){
                for(var i=0;i<hearts.length;i++){
                    if(hearts[i].alpha <=0){
                        document.body.removeChild(hearts[i].el);
                        hearts.splice(i,1);
                        continue;
                    }
                    hearts[i].y--;
                    hearts[i].scale += 0.004;
                    hearts[i].alpha -= 0.013;
                    hearts[i].el.style.cssText = "left:"+hearts[i].x+"px;top:"+hearts[i].y+"px;opacity:"+hearts[i].alpha+";transform:scale("+hearts[i].scale+","+hearts[i].scale+") rotate(45deg);background:"+hearts[i].color;
                }
                requestAnimationFrame(gameloop);
            }
            function attachEvent(){
                var old = typeof window.onclick==="function" && window.onclick;
                window.onclick = function(event){
                    old && old();
                    createHeart(event);
                }
            }
            function createHeart(event){
                var d = document.createElement("div");
                d.className = "heart";
                hearts.push({
                    el : d,
                    x : event.clientX - 5,
                    y : event.clientY - 5,
                    scale : 1,
                    alpha : 1,
                    color : randomColor()
                });
                document.body.appendChild(d);
            }
            function css(css){
                var style = document.createElement("style");
                style.type="text/css";
                try{
                    style.appendChild(document.createTextNode(css));
                }catch(ex){
                    style.styleSheet.cssText = css;
                }
                document.getElementsByTagName('head')[0].appendChild(style);
            }
            function randomColor(){
                return "rgb("+(~~(Math.random()*255))+","+(~~(Math.random()*255))+","+(~~(Math.random()*255))+")";
            }
        })(window,document);

        </script>  
 </body>
</html>